services:
  gateway:
    build: .
    container_name: graphql_gateway
    # Puertos comentados para uso con Nginx (producción)
    # Descomenta la línea siguiente solo para desarrollo directo:
    # ports:
    #   - "4000:4000"
    expose:
      - "4000"  # Solo exponer dentro de Docker
    env_file:
      - .env
    volumes:
      - ./gateway:/app/gateway
    networks:
      - dmz_network      # Interfaz pública: recibe peticiones del frontend/nginx
      - backend_network  # Interfaz privada: comunica con microservicios

# =============================================================================
# REDES SEGMENTADAS
# =============================================================================
# El Gateway requiere acceso a 2 redes:
#   - dmz_network: Para comunicarse con el frontend (zona pública)
#   - backend_network: Para comunicarse con los microservicios (zona privada)
#
# PREREQUISITO: Las redes deben existir antes de levantar el servicio.
# Ejecutar: bash scripts/setup-networks.sh
# =============================================================================
networks:
  dmz_network:
    external: true
    name: dmz_network
  
  backend_network:
    external: true
    name: backend_network